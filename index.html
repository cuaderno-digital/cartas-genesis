<!DOCTYPE html>
<html lang="es">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸš€ CASINO GENESIS - CARTAS ğŸš€</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at 20% 20%, #ffffff11 1%, transparent 2%), 
            radial-gradient(circle at 40% 80%, #ffffff11 1%, transparent 2%), 
            radial-gradient(circle at 80% 30%, #ffffff11 1%, transparent 2%), 
            radial-gradient(circle at 70% 60%, #ffffff11 1%, transparent 2%), 
            radial-gradient(circle at 50% 50%, #ffffff22 1%, transparent 2%),
            black;
      font-family: 'Arial Black', sans-serif;
      color: #e0e0e0;
      text-align: center;
      background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    }

    h1 {
      color: #7DF9FF;
      text-shadow: 0 0 15px #7DF9FF;
      margin: 10px 0 5px;
      font-size: 26px;
    }

    .top-info {
      margin: 2px 0;
      font-size: 14px;
    }

    .frase-juego {
      font-size: 13px;
      margin: 4px 0 6px;
      line-height: 1;
      font-weight: normal;
      margin-bottom: 5px;
    }

    h4 {
      font-size: 14px;
      margin: 5px 0 0;
    }

    .hidden {
      display: none;
    }

    .input-container input,
    #username {
      padding: 12px;
      font-size: 16px;
      width: 80%;
      border: none;
      border-radius: 8px;
      text-align: center;
      background: #1c1c2b;
      color: white;
      border: 2px solid #7DF9FF;
    }
    .input-container input.error {
      border: 2px solid red;
    }
    .btn,
    button {
      margin-top: 20px;
      padding: 15px 25px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #7DF9FF, #8A2BE2);
      color: black;
      font-weight: bold;
      box-shadow: 0 0 10px #7DF9FF;
    }

    .whatsapp {
      background-color: #25D366;
      color: white;
      margin-top: 20px;
      padding: 12px;
      display: inline-block;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 0 10px #25D366;
    }

    .game-area {
      max-width: 420px;
      margin: auto;
      padding-bottom: 60px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      justify-content: center;
    }

    .card {
      width: 60px;
      height: 80px;
      border-radius: 10px;
      perspective: 1000px;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 1s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
    }

    .card-front {
      background-color: #7DF9FF;
      color: black;
    }

    .card-back {
      transform: rotateY(180deg);
      flex-direction: column;
      background-color: #1a1a2e;
      color: white;
    }

    .prize-list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 10px 0 15px;
    }

    .prize-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px;
  height: 75px;
  background-color: #0b0f1a;
  border: 2px solid #7DF9FF;
  border-radius: 12px;
  font-size: 14px;
  color: white;
  box-sizing: border-box;
  overflow: hidden;
}

.premio-box {
  background-color: white;
  color: black;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
  font-size: 10px;
  font-weight: bold;
  text-align: center;
  line-height: 1.2;
  max-width: 95%;
  word-wrap: break-word;
}

    .card-grid-wrapper {
      padding: 10px;
      border: 2px solid #7DF9FF;
      border-radius: 10px;
      margin-top: 10px;
    }

    #result {
      font-size: 18px;
      margin-top: 10px;
      color: #000;
      background-color: #7DF9FF;
      border: 2px solid #8A2BE2;
      border-radius: 10px;
      display: inline-block;
      padding: 10px 15px;
      font-weight: bold;
      width: 100%;
      max-width: 420px;
      box-sizing: border-box;
    }

    .reclamo-info {
      margin-top: 10px;
      font-size: 10px;
      font-weight: bold;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card.disabled {
      opacity: 0.4;
      pointer-events: none;
      filter: grayscale(100%);
    }

    #info-footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #7DF9FF;
      color: black;
      border-radius: 12px 12px 0 0;
      padding: 1rem 0.5rem;
      box-shadow: 0 0 12px #8A2BE2;
      font-weight: bold;
      text-align: center;
      z-index: 999;
    }

    #info-footer a {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="start-screen">
    <div class="container">
      <h1 style="font-size: 1.8rem; margin-top: 10px;">ğŸƒCASINO GENESIS - CARTASğŸƒ</h1>
      <input id="username" placeholder="ğŸ¤´ INGRESÃ TU USUARIO ğŸ¥‡" class="input-container" />
      <button onclick="startGame()" class="btn">ğŸ° ENTRAR AL CASINO ğŸ°</button>
      <div id="info-footer" style="
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #d9f5ff;
        color: black;
        border-radius: 12px 12px 0 0;
        padding: 1rem 0.5rem;
        box-shadow: 0 0 12px #38bdf8;
        font-weight: bold;
        text-align: center;
        z-index: 999;
      ">
        <div style="font-size: 1.3rem;">ğŸ’™ CASINO GENESIS ğŸ’™</div>
        <div style="margin-top: 5px;">ğŸ’¬ SOPORTE ACTIVO 24HS - PAGAMOS AL INSTANTE ğŸ’¬</div>
        <a href="https://wa.me/5491139432743" target="_blank" class="whatsapp">ğŸ“ HABLÃ CON NOSOTROS</a>
      </div>
    </div>
  </div>

  <div id="game-screen" class="hidden">
    <div class="game-area">
      <h1>CASINO GENESIS - CARTAS</h1>
      <p class="top-info">ğŸ“… <span id="fecha"></span> ğŸ•’ <span id="hora"></span></p>
      <p class="top-info">ğŸ‘¤ <span id="nombre-usuario"></span></p>
      <p class="frase-juego">ğŸ¯ DestapÃ¡ las cartas... Â¡Si hacÃ©s 3 iguales, GANÃS!</p>
      <h4>ğŸ Premios posibles:</h4>
      <div class="prize-list">
  <div class="prize-item" style="background-color: #0aa249;">ğŸª <span class="premio-box">2.500 GRATIS</span></div>
  <div class="prize-item" style="background-color: #FF1493;">ğŸŒ  <span class="premio-box">100% BONO</span></div>
  <div class="prize-item" style="background-color: #FF8C00;">ğŸ›°ï¸ <span class="premio-box">50% BONO</span></div>
  <div class="prize-item" style="background-color: #DC143C;">ğŸŒŒ <span class="premio-box">20% BONO</span></div>
  <div class="prize-item" style="background-color: #1E90FF;">ğŸ’ <span class="premio-box">10.000 GRATIS</span></div>
  <div class="prize-item" style="background-color: #BA55D3;">â˜„ï¸ <span class="premio-box">5.000 GRATIS</span></div>
  <div class="prize-item" style="background-color: #FFD700;">ğŸ‘¾ <span class="premio-box">JACKPOT GENESIS</span></div>
  <div class="prize-item" style="background-color: #2F4F4F;">ğŸ‘½ <span class="premio-box">100.000 GENESIS</span></div>
</div>
      <div class="card-grid-wrapper">
        <div class="card-grid" id="cardGrid"></div>
      </div>
      <div id="result"></div>
      <p class="reclamo-info">ğŸ“² SACÃ CAPTURA Y ENVIANOS POR WHATSAPP PARA RECLAMAR TU PREMIO</p>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://ueiiyibsnmapzygpmeza.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlaWl5aWJzbm1hcHp5Z3BtZXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzODc2NzMsImV4cCI6MjA2Njk2MzY3M30.8yDCfUXBhqeEyFvPL5Pz7W5WWlbK4N25UOEXx4n1hdo';
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const hoy = new Date().toISOString().split('T')[0];
    let fingerprint = "";
    let casino = "CASINO GENESIS - CARTAS";

    let fpReady = FingerprintJS.load().then(fp => fp.get().then(result => {
      fingerprint = result.visitorId;
    }));

    const premios = [
  { nombre: '2.500 GRATIS', emoji: 'ğŸª', fondo: '#0aa249', cantidad: 4 },
  { nombre: '100% BONO', emoji: 'ğŸŒ ', fondo: '#FF1493', cantidad: 3 },
  { nombre: '50% BONO', emoji: 'ğŸ›°ï¸', fondo: '#FF8C00', cantidad: 3 },
  { nombre: '20% BONO', emoji: 'ğŸŒŒ', fondo: '#DC143C', cantidad: 4 },
  { nombre: '10.000 GRATIS', emoji: 'ğŸ’', fondo: '#1E90FF', cantidad: 3 },
  { nombre: '5.000 GRATIS', emoji: 'â˜„ï¸', fondo: '#BA55D3', cantidad: 3 },
  { nombre: 'JACKPOT GENESIS', emoji: 'ğŸ‘¾', fondo: '#FFD700', cantidad: 2 },
  { nombre: '100.000 GENESIS', emoji: 'ğŸ‘½', fondo: '#2F4F4F', cantidad: 2 },
];

let username = "";
let ganador = false;

    async function startGame() {
  const input = document.getElementById('username');
  const nombre = input.value.trim();
  if (!nombre) {
  input.classList.add('error');
  input.style.border = '2px solid red';
  return;
}
input.classList.remove('error');
input.style.border = 'none';
  username = nombre;
  await fpReady;
  while (!fingerprint) await new Promise(r => setTimeout(r, 50));
  const jugado = await yaJugoHoy(username);

  if (jugado) {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    document.getElementById('nombre-usuario').textContent = username;
    const now = new Date();
    document.getElementById('fecha').textContent = now.toLocaleDateString('es-AR');
    document.getElementById('hora').textContent = now.toLocaleTimeString('es-AR', {
      timeZone: 'America/Argentina/Buenos_Aires',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });

    // mostrar cartas pero sin permitir girar
    loadCards();
setTimeout(() => {
  document.querySelectorAll('.card').forEach(c => {
    c.classList.add('disabled');
    c.onclick = null;
  });
}, 100); // le damos un mini delay para que ya estÃ©n montadas
    document.getElementById('result').innerHTML = `
  <div style="font-size: 20px; margin-bottom: 6px;">ğŸ›‘ YA JUGASTE HOY ğŸ›‘</div>
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap;">
    <span>ğŸ‘¤ ${jugado.usuarioReal.toUpperCase()}</span>
    <span>ğŸ ${jugado.premio}</span>
  </div>
  <div style="font-size: 11px; margin-top: 6px;">ğŸ“² Si creÃ©s que esto es un error, contactanos por WhatsApp.</div>
  <a class="whatsapp" href="https://wa.me/5491139432743" target="_blank" style="margin-top: 6px;">ğŸ“ CONTACTAR</a>
`;
    return;
  }

  // si no jugÃ³, continÃºa normal
  input.classList.remove('error');
  document.getElementById('start-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  document.getElementById('nombre-usuario').textContent = nombre;
  const now = new Date();
  document.getElementById('fecha').textContent = now.toLocaleDateString('es-AR');
  document.getElementById('hora').textContent = now.toLocaleTimeString('es-AR', {
    timeZone: 'America/Argentina/Buenos_Aires',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });
  loadCards();
}

    function loadCards() {
  const grid = document.getElementById('cardGrid');
grid.innerHTML = '';
selected = [];
ganador = false;

// ğŸ‘‰ Nueva mezcla random por cantidad fija
const mezclaFinal = [];
premios.forEach(p => {
  for (let i = 0; i < p.cantidad; i++) {
    mezclaFinal.push({ ...p });
  }
});
mezclaFinal.sort(() => Math.random() - 0.5);

  mezclaFinal.forEach(carta => {
    const cartaEl = document.createElement('div');
    cartaEl.className = 'card';
    cartaEl.dataset.tipo = carta.nombre;
    cartaEl.dataset.emoji = carta.emoji;
    cartaEl.dataset.color = carta.fondo;

    cartaEl.onclick = () => girarCarta(cartaEl);

    const inner = document.createElement('div');
    inner.className = 'card-inner';

    const front = document.createElement('div');
    front.className = 'card-front';
    front.innerHTML = `<div style="font-size: 30px;">ğŸš€</div>`;

    const back = document.createElement('div');
    back.className = 'card-back';
    back.style.background = carta.fondo;
    back.innerHTML = `
      <div style="font-size: 20px; margin-bottom: 3px;">${carta.emoji}</div>
      <div class="premio-box">${carta.nombre}</div>
    `;

    inner.appendChild(front);
    inner.appendChild(back);
    cartaEl.appendChild(inner);
    grid.appendChild(cartaEl);
  });
}

function girarCarta(carta) {
  if (carta.classList.contains('flipped') || ganador) return;

  let cartaReal = carta;

  const tipo = cartaReal.dataset.tipo;
  const emoji = cartaReal.dataset.emoji;
  const fondo = cartaReal.dataset.color;

  // Giramos la carta tocada pero le ponemos el contenido de la real
  carta.classList.add('flipped');
  const back = carta.querySelector('.card-back');
  back.style.background = fondo;
  back.innerHTML = `
    <div style="font-size: 20px; margin-bottom: 3px;">${emoji}</div>
    <div class="premio-box">${tipo}</div>
  `;

  // LÃ³gica de conteo y verificaciÃ³n
  selected.push(tipo);
  const conteo = selected.reduce((acc, n) => {
    acc[n] = (acc[n] || 0) + 1;
    return acc;
  }, {});

  if (conteo[tipo] === 3 && !ganador) {
  ganador = true;
  document.getElementById('result').innerHTML =
    `ğŸ‰ Felicidades ${username.toUpperCase()}, ganaste ${emoji} ${tipo}`;
  document.querySelectorAll('.card').forEach(c => c.onclick = null);

  // ğŸ‘‰ Esta lÃ­nea es la que guarda en la nube
  registrarGiro(`${tipo} ${emoji}`);
}
}
async function yaJugoHoy(usuario) {
  try {
    const { data, error } = await client
      .from('giros')
      .select('premio, usuario')
      .eq('fecha', hoy)
      .eq('casino', casino)
      .or(`usuario.eq.${usuario},fingerprint.eq.${fingerprint}`)
      .limit(1)
      .maybeSingle();

    if (error) {
      console.error("âŒ Error consultando Supabase:", error);
      return null;
    }

    return data ? { premio: data.premio, usuarioReal: data.usuario } : null;
  } catch (e) {
    console.error("âŒ ExcepciÃ³n en yaJugoHoy:", e);
    return null;
  }
}
async function registrarGiro(premio) {
  const hora = new Date().toISOString();
  await client.from('giros').insert([{
    usuario: username,
    fingerprint,
    premio,
    fecha: hoy,
    hora,
    casino
  }]);
}
</script>
</body>
</html>
